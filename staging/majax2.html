<html><head><title>MAJAX - The Millennium AJAX Library</title><!--    MAJAX - The Millennium AJAX Library    Copyright 2006 by Godmar Back godmar@gmail.com     and Annette Bailey, Virginia Tech.    License: This software is released under the LGPL license,    See http://www.gnu.org/licenses/lgpl.txt    $Id: majax.html,v 1.22 2007/05/22 16:08:01 gback Exp gback $    Instructions:    ------------    This file must be placed into the /screens directory of a III    Millennium installation.   Subsequently, other webpages can     include this file in a hidden iframe to make AJAX calls to     the Millennium system.--><script type="text/javascript">/* Determine correct superdomain from the domain from  * which this document is served. * If the library is hosted on addison.vt.edu/screens, all hosts * in the *.vt.edu domain can access it, if {1} is used in the  * regexp below.  {1} means 1 level below the top-level domain .edu * * If the library were hosted in catalog.lib.institution.edu, * {2} would restrict access to all *.lib.institution.edu pages. * Adjust as desired. */var superdomain = document.domain.replace(/.*\.(([^.]+\.){1}[^.]+)$/, "$1");var catalogUrl = "http://" + document.domain;var debug = false;/* * xmlhttp.js * adapted from latest version published at * http://jibbering.com/2002/4/httprequest.html */function getXHR() {    var xmlhttp=false;    /*@cc_on @*/    /*@if (@_jscript_version >= 5)    // JScript gives us Conditional compilation, we can cope with old IE versions.    // and security blocked creation of the objects.     try {      xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");     } catch (e) {      try {       xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");      } catch (E) {       xmlhttp = false;      }     }    @end @*/    if (!xmlhttp && typeof XMLHttpRequest!='undefined') {            try {                    xmlhttp = new XMLHttpRequest();            } catch (e) {                    xmlhttp=false;            }    }    if (!xmlhttp && window.createRequest) {            try {                    xmlhttp = window.createRequest();            } catch (e) {                    xmlhttp=false;            }    }    return xmlhttp;}function getUrl(url, cb) {    var xmlhttp = getXHR();    xmlhttp.open("GET", url, true);     // true mean asynchronous    xmlhttp.onreadystatechange = function() {        if (xmlhttp.readyState == 4) {            cb(xmlhttp.status,               xmlhttp.getAllResponseHeaders(),               xmlhttp.responseText);        }    }    xmlhttp.send(null);}var useProxy = false;// we test via proxy on libx.org if (document.domain == "addison.libx.org") {    useProxy = true;    // uncomment the one to test via proxy from libx.org    catalogUrl = "http://addison.vt.edu";    // catalogUrl = "http://laurel.lib.vt.edu";    // catalogUrl = "http://www.library.lafayette.edu";    // catalogUrl = "http://catalogue.wellcome.ac.uk:2082";    superdomain = "libx.org";    function proxyUrl(url) {        return "http://addison.libx.org/majax/proxy.php?url="                 + encodeURIComponent(url);    }}String.prototype.trim = function() {     return this.replace(/^\s+|\s+$/g, ''); };/* Parse XMLHttp result from catalog, return parsed result as Javascript object */function majaxParseResult(response, sterm){    var result = new Object();    // extract MARC record information, which is embedded in <PRE></PRE> tags    var marcrecord = /<pre>\n(LEADER(.|\n)*)<\/pre>/i;    var m = response.match(marcrecord);    if (!m) {        result.found = false;        return result;    }    var marctext = m[1];    result.marctext = marctext;    // parse MARC    var marc = new Object();    var marcfield = /^(\d{3}) (\d| )(\d| ) (.*)((?:\n[ ]{7}(.+))*)$/mg;    var m;    while ((m = marcfield.exec(marctext)) != null) {        var fcode = m[1];        var ind1 = m[2];        var ind2 = m[3];        var turnnewlineintospace = fcode == '245';        var content = (m[4] + m[5].replace(/\n[ ]{7}/g,                         (turnnewlineintospace ? " " : "")).replace(/\s+/g, " ")).trim();        var midx = 'datafield' + fcode;        if (marc[midx] == undefined) {            marc[midx] = new Array();        }        var field = { ind1: ind1, ind2: ind2, field: content };        marc[midx].push(field);        marc['f' + fcode] = marc[midx][0];      // add fXXX shortcuts    }    // parse subfields    for (var fcode in marc) {        for (var i = 0; i < marc[fcode].length; i++) {            var mfi = marc[fcode][i];            var content = mfi.field;            delete mfi.field;            var subcodes = new Object();            var marcsubfield = /(\|(\S)([^|\n]*))(\||$)/;            while ((subm = marcsubfield.exec(content)) != null) {                var subcode = subm[2];                var subfield = subm[3].trim();                if (subcodes[subcode] == undefined) {                    subcodes[subcode] = new Array();                }                subcodes[subcode].push(subfield);                content = content.replace(subm[1], "");            }            mfi.subfields = subcodes;            // add rest to default subfield 'a'            if (content != "") {                if (mfi.subfields.a == undefined) {                    mfi.subfields.a =new Array();                }                mfi.subfields.a.push(content);            }                    // create shortcuts            for (var sf in mfi.subfields) {                mfi[sf] = mfi.subfields[sf][0];            }        }    }    /* Create EndNote format */    /* Example:    %A Levitt, Steven D.    %D c2005.    %T Freakonomics : a rogue economist explores the hidden side of everything    %E Dubner, Stephen J.    %C New York :    %I William Morrow,    %V xii, 242 p. ;    %N HB74.P8 L479 2005    %Y Dubner, Stephen J.    %7 1st ed.    %@ 006073132X    %3 Economics -- Psychological aspects.    %3 Economics -- Sociological aspects.    */       try {        // unsubstitute HTML entities, then        // remove trailing periods, commas, colons etc.        function clean(s) {            return s.replace(/&#59;/g, ";")                .replace(/[;,.: \/]+$/g, "").trim();        }        function clean2(s) {    // does not remove periods to leave initials intact            return s.replace(/[;,: \/]+$/g, "").trim();        }        var o = "";        if (marc.f100 && marc.f100.a) o +=  clean2(marc.f100.a);        if (marc.f245 && marc.f245.a) o += (marc.f245.a);        if (marc.f245 && marc.f245.b) o += clean(marc.f245.b);        if (marc.f700 && marc.f700.a) o += clean2(marc.f700.a);        if (marc.f700 && marc.f700.a) o += (marc.f700.a);              for (var i = 0; marc.datafield650 && i < marc.datafield650.length; i++) {            o += "\n%3 " + clean(marc.datafield650[i].a);            if (marc.datafield650[i].x) o += " -- " + clean(marc.datafield650[i].x);            if (marc.datafield650[i].z) o += " -- " + clean(marc.datafield650[i].z);        }        // TBD: %O, %K - what do these mean?        // NB: we use CRLF such that IE can convert them directly into TextNodes         result.endnote = o.replace(/^\n/m, "").replace(/\n/g, "\n\r");    } catch (er) {        result.endnoteerror = "majax: error occurred during conversion to EndNote format: " + er;    }    result.marc = marc;    // extract holdings    // <!-- field % -->&nbsp; DUE 09-17-06</td>    // or     // <!-- field % -->&nbsp; DUE 09-17-06 <!-- field % -->...    var holdings = new Array();    var holdingsformat = /<!-- field % -->([^<]*)</g;    while ((hm = holdingsformat.exec(response)) != null) {        var h = hm[1].replace(/&nbsp;/g, " ").trim();        holdings.push(h);    }    // XXX extract holdings for Journals here...    // TBD    // ------    result.holdings = holdings;    var bibscreen = response.match(/<table.*class=\"bibItems\"(.|\n)*<\/table>/);    if (bibscreen) {        // fix up links        result.bibscreen = bibscreen[0].replace(marcrecord, "")                            .replace(/(href="?)\//g, "$1" + catalogUrl + "/");    }    /* Determine if the results we parsed came from the query that was sent.     * Addison tends to use the record that comes in the browse screen next     * after a failed search; we check that the ISBN field matches if we     * searched by ISBN, or else that the Title 245.a field matches our title     * search term.     *     * XXX: A better approach might be to first search and determine if the     * item is a hit.     */    result.found = false;    var cterm = sterm.substr(1);    if (sterm.match(/^i/i)) {        // ISBN        if (marc.f020 && marc.f020.a && marc.f020.a.match(new RegExp(cterm, 'i'))) {            result.found = true;        }        // ISSN        if (marc.f022 && marc.f022.a && marc.f022.a.replace(/-/g, "").match(new RegExp(cterm, 'i'))) {            result.found = true;        }    } else        /* check if title we were looking for is found in 245$a field. */    if (sterm.match(/^t/i) && marc.f245 && marc.f245.a && marc.f245.a.match(new RegExp(decodeURIComponent(cterm), 'i'))) {        result.found = true;    } else    if (sterm.match(/^\./)) {           // there's no way to see if a record retrieved matches what's desired        result.found = true;    } else    if (sterm.match(/^o/)) {    // OCLC number        if (marc.f001 && marc.f001.a.match(cterm))            result.found = true;    }    result.majaxMakeEndnoteDisplay = majaxMakeEndnoteDisplay;    result.majaxMakeHarvardReference = majaxMakeHarvardReference;    result.majaxMakeEndnoteImport = function (doc, anchor) {    // anchor is optional        var ptext = this.endnote.replace(/\n/g, "\n\r");        if (anchor == null) anchor = doc.createElement("A");        anchor.setAttribute("href", "data:application/x-endnote-refer," + escape(ptext));        return anchor;    }    return result;}function majaxSearchURL(sterm) {    return catalogUrl + "/search" + "/" + sterm;}function majaxSearch(sterm, majaxRequest){    // construct URL to MARC record by searchterm page    var recordurl = catalogUrl + "/search" + "/" + sterm;    var url = recordurl + "/" + sterm + "/1,1,1,E/marc&FF=" + sterm;    if (debug) {        window.open(url);    }    if (useProxy) url = proxyUrl(url);    function oncompletion(status, headers, response) {        // these must be transparently followed, so the shouldn't cause an oncompletion        // callback - but apparently, they sometimes do.        if (status == 301 || status == 302 || status == 303 || status == 307)            return;        if (status == 200) {    // "200" means OK            var result = majaxParseResult(response, sterm);            if (result.found) {                result.recordurl = recordurl;                majaxRequest.onsuccess(result);            } else                if (majaxRequest.onfailure != null)                    majaxRequest.onfailure(status);        } else        if (status == 404) {    // "404" means Page Not Found            if (majaxRequest.onfailure != null)                majaxRequest.onfailure(status);        } else {            alert("code " + status + " not yet handled, please implement");        }    };    getUrl(url, oncompletion);}/* * Search for an ISBN 'isbn' in the catalog. * Calls function 'callonsuccess' on success, * 'callonfailure' if failed.   * XXX - should we have a found/not found function? */function majaxSearchByISBN(isbn, majaxRequest){    isbn = isbn.replace(/\-/g, "");    return majaxSearch("i" + isbn, majaxRequest);}/* * Search for an Title 'title' in the catalog. * See majaxSearchByISBN. */function majaxSearchByTitle(title, majaxRequest){    return majaxSearch("t" + title.toLowerCase(), majaxRequest);}function majaxSearchByRecord(recordno, majaxRequest){    return majaxSearch(".b" + recordno, majaxRequest);}/* From: http://www.howtowritetermpapers.com/harvard.htm To reference a book, the details required in order are:    * Name/s of author/s, editor/s, compiler/s or the institution responsible    * Year of publication    * Title of publication    * Series title and individual volume if applicable    * Edition if other than first    * Place of publication    * Publisher    * Page number(s) if applicable */function majaxMakeHarvardReference(){    var marc = this.marc;    var o = "";	function clean(s) {	 return s.replace(/&#59;/g, ";")	.replace(/[;,.: \/]+$/g, "").trim();        }		 o += '<i>';    if (marc.f245 && marc.f245.a) {        o += clean(marc.f245.a);        if (marc.f245.b)            o += " " + clean(marc.f245.b);    }    o += '</i> ';	    if (marc.f100 && marc.f100.a) {        o += "/" +clean(marc.f100.a);    }       return o.replace(/, $/, "");}/* * Create a DIV element that enclosed a Show/Hide anchor * and embeds the endnote display in an PRE inside an  * inner div.  */function majaxMakeEndnoteDisplay(doc, labelText, showText, hideText, preclass){    var p = doc.createElement("PRE");    if (preclass != undefined)        p.className = preclass;    var ptext = this.endnote;    p.appendChild(doc.createTextNode(ptext));    var innerdiv = doc.createElement("DIV");    innerdiv.style.display = 'none';    innerdiv.appendChild(p);    var a = doc.createElement("A");    var t = doc.createTextNode(showText);    a.appendChild(t);    a.setAttribute("href", "javascript:;");    var oc = function (event) {         var label;        if (innerdiv.style.display == "block") {            innerdiv.style.display = "none";            label = showText;        } else {            innerdiv.style.display = "block";            label = hideText;        }        a.removeChild(a.firstChild);        var t = doc.createTextNode(label);        a.insertBefore(t, a.firstChild);        return false;    };    // a.onclick seems to not work in FF 1.5.0.4    // and IE does not have addEventListener    if (a.addEventListener)        a.addEventListener("click", oc, false);    else        a.onclick = oc;    var outerdiv = doc.createElement("DIV");    outerdiv.appendChild(a);    var s;    s = doc.createElement("SPAN");    s.innerHTML = "&nbsp;" + labelText;    outerdiv.appendChild(s);    outerdiv.appendChild(innerdiv);    return outerdiv;}/* * We adjust our document.domain to be able to talk to our parent frame. * We retain our ability to make XHR calls to the originating domain, * which is the III installation in this case. */try {    document.domain = superdomain;} catch (e) {    alert("majax: Cannot set document.domain to " + superdomain);}</script><style>pre {    background: lightgreen;    border-style: groove;}pre.example {    background: orange;    border-style: groove;}dt {    font-weight: bold;}dd, dt {    margin-bottom: 1em;}</style></head><body><h1> MAJAX - The Millennium AJAX Library </h1><p>    <b> Copyright 2006-2007 by Godmar Back and Annette Bailey (libx.org@gmail.com), Virginia Tech. </b><p>    License: This software is released under the LGPL license,    See <a href="http://www.gnu.org/licenses/lgpl.txt">http://www.gnu.org/licenses/lgpl.txt</a>.<p><i>$Id: majax.html,v 1.22 2007/05/22 16:08:01 gback Exp gback $</i><p>Two files: this file, <a href="majax.html">majax.html</a> and the file <a href="majax.js">majax.js</a>must be uploaded to your Millennium installation's/screens directory.  Subsequently, the functionality it providescan be used on any page that is served from within the same domain.In particular, MAJAX can be used from within the Millennium resultspages, or the pages created by WebBridge, or any other staticor dynamic web page served by a server in your domain.<p>MAJAX should automatically determine thecorrect domain based on where the file is located.  For instance, if located in addison.vt.edu/screens, MAJAX would allow access from all pages in the *.vt.edu domain.Using the automatic domain detection, this copy of MAJAX would allow access from all pages from within the <b><font color="green"><script>document.write("*." + superdomain);</script></b></font> domain.(The domain on the previous line shown <font color="green">in green</font> should show your domain <i>after</i> you copied majax.html to your /screens directory.)<b>MAJAX cannot be used by any webpage outside this domain, becauseof the same-origin restriction inherent in the JavaScript security model.</b><p>Some people may wonder why we are using AJAX and this hidden iframe, rather than dynamic &lt;script&gt; tags.  The answer is that MAJAX doesnot want to rely on any server-side support other than the ability to uploadmajax.js and majax.html to III's server.<p>MAJAX was tested with Firefox 1.5.0.* and FF 2.0.* and IE 6.0.2 and IE 7.<p><h2>Using MAJAX</h2>To use MAJAX in a page, simply include the following &lt;script&gt; element in the &lt;head&gt;&lt;/head&gt; section of your webpage:<pre> &lt;script type="text/javascript" src="http://<font color="red">your.millennium.domain</font>/screens/majax.js"&gt; &lt;/script&gt;</pre>Replace the <font color="red">your.millennium.domain</font> with thehostname of your Millennium installation.<p>That's it!  Now you can use make use of MAJAX on your webpage.<p>There are two ways in which to use MAJAX.The first way is recommended for most users.  It does not require anyJavascript coding.  Instead, in those places where you want MAJAX to insertinformation from the catalog, place HTML &lt;span&gt; elements.For example:<pre> ISBN: 0743226712 &lt;span class="majax-showholdings" title="i0743226712"&gt;&lt;/span&gt;</pre>When this page is loaded, MAJAX will insert a note that shows theholdings for the book with ISBN 0743226712.The output may look like this:<p> ISBN: 0743226712 (2 copies held: AVAILABLE AVAILABLE)</p>No Javascript code is required: simply place appropriate &lt;span&gt; tagsin your document.  MAJAX will replace them with information from thecatalog.  Use the <tt>class</tt> and the <tt>title</tt> attributes tospecify what information should be shown.<p>MAJAX supports the following options for these attributes.<ol><li>ISBN search: use <tt>title="iXXXXXXXXXX"</tt> and         replace XXXXXXXXXX with the ISBN for which to search.<li>Bibrecord search: use <tt>title=".bYYYYYYYY"</tt> and         replace YYYYYYY with the record number for which to search.          Note the dot before the 'b'.<li>Title search: use <tt>title="tzzzzzzzz"</tt> and replace zzzzzzzzz        with a book title.  Use %20 for spaces.<li>OCLC number search: use <tt>title="onnnnnn"</tt> and replace    nnnnnnn with the OCLC number.  This will only be successful if the    OCLC number is listed in 001$a.</ol>To determine which information is displayed include one of thefollowing strings in the <tt>class</tt> attribute:<dl><dt><tt>majax-showholdings</tt><dd>        Shows how many copies are listed in the catalog, and their        current status.<dt><tt>majax-endnote</tt><dd>    Includes a preformatted textbox that can be copied and        pasted into Endnote<dt><tt>majax-endnote-switch</tt><dd>    Like majax-endnote, except textbox can be shown/hidden by        clicking on a link.<dt><tt>majax-endnote-import</tt><dd>    Displays a link that can be directly imported into Endnote.<dt><tt>majax-harvard-reference</tt><dd>    Displays a citation of the item in Harvard reference style.</dl>Send us requests/ideas for others.<h2>Styling MAJAX</h2>You may, optionally, apply a CSS style by specifying CSS style rules for the existing styles.<pre> &lt;style&gt; .majax-showholdings {     font-weight: bold;     color: red; } &lt;/style&gt;</pre>would show all holdings information <font color="red" style="font-weight: bold">in bold red</font>.<p>You can also provide additional classes for the MAJAX &lt;span&gt; tag'sclass attribute. For instance, <tt>&lt;span class="showitalic majax-showholdings" ....&gt; ... </tt>would also apply the style rules associated with class "showitalic" tothe holdings information. In this way, you may apply different stylesto different span elements.<hr /><b>The documentation below refers to how to use MAJAX from JavaScript.</b><p>MAJAX can only be used after it has finished loading.You can associate a handler that is called when MAJAX finishes loading by calling<pre> majaxRunBeforeSpanProcessing(handler);</pre>from anywhere in the document.Note that the &lt;body&gt; element's onload handler cannot be used.(The reason is that this handler is used to start loading the inner majax frame;MAJAX is only available after this inner frame has finished loading.)<p>Calling <tt>majaxProcessSpans()</tt> will process new span elements.It ensures that each span element is only processed once.<p><h2>MAJAX Functions</h2>MAJAX provides the following functions, which can be accessed as methodsof the frame object in the embedding page, e.g., using the dot notation asin 'majax.majaxSearchByISBN'.<pre> majaxSearchByISBN(isbn, majaxRequest); majaxSearchByTitle(title, majaxRequest); debug</pre>whereby<dl><dt>debug</dt>    <dd>        a boolean. If true, MAJAX will open a new window on every request        that display the URL MAJAX is requesting from Millennium.        Provided for debugging.    </dd><dt>isbn</dt>    <dd>of type string is the ISBN for which to look.         This search uses the 'i' index of Millennium and looks        up and parses the MARC record for the item found.    </dd><dt>title</dt>    <dd>of type string is the title for which to look.        As with ISBN, the MARC record is looked up.    </dd><dt>majaxRequest.onsuccess</dt>    <dd>of type function.        The function 'majaxRequest.onsuccess(majaxresult)' is called        if a MARC record was found and successfully parsed.        'majaxresult' is a JavaScript object that contains the information        MAJAX obtained from Millennium.        'majaxresult' has the following properties:        <p>        <table border="1" cellpadding="5">        <tr><th>property</th><th>type</th><th>meaning</th></tr>        <tr><td><tt>endnote</tt></td><td>string</td><td>A string that contains a representation suitable for export into EndNote.                        </td></tr>        <tr><td><tt>endnoteerror</tt></td><td>string</td><td>If an error occurred during the creation of the 'endnote' property,                        the 'endnote' property is not set and this property is set instead.                        </td></tr>        <tr><td><tt>marc</tt></td><td>object</td><td>contains the parsed MARC record.                          <a href="#majaxmarc">See below.</a>                                </td></tr>        <tr><td><tt>holdings</tt></td><td>array of strings</td>                        <td>Entries in the array correspond to the                             holdings status of the available copies of an item,                            e.g. "DUE xx-xx-xxxx", or "AVAILABLE", etc.</td></tr>        <tr><td><tt>recordurl</tt></td><td>string</td><td>A URL to the catalog record describing this item.                        </td></tr>        <tr><td><tt>bibscreen</tt></td><td>string</td>                                <td>The original HTML of the so-called BIBSCREEN                                 extracted from the MARC display.  This is usually                                a section with a table that describes the holdings.                                Provided for debugging mainly.                        </td></tr>        <tr><td><tt>marctext</tt></td><td>string</td><td>The original MARC record as extracted from the MARC display.                                 Provided for debugging.</td></tr>        <tr><td><tt>majaxMakeEndnoteDisplay()</tt></td><td>function</td><td>When called,                this function creates a hidable PRE element in which                 the EndNote reference is displayed.  The element can be                inserted anywhere on the page.                  <a href="#majaxMakeEndnoteDisplay">                        See below for more information.</a>                </td></tr>        <tr><td><tt>majaxMakeHarvardReference()</tt></td><td>function</td>                <td>When called,                this function creates an string of HTML that display                a formatted reference according to Harvard-style (Author-Date).                The string can be inserted anywhere on the page, for instance                by assigning it to an innerHTML property of a known                 SPAN element.                  <a href="#majaxMakeHarvardReference">                        See below for more information.</a>                </td></tr>        </table><dt>majaxRequest.onfailure</dt>    <dd>of type function.        If present, the method 'majaxRequest.onfailure(status)' is called if either the        request failed or the ISBN or title was not found.        status is 200 if the request succeeded, but Millennium returned a different        MARC record; else status is 404.         Millennium tends to return neighboring records if a specific title or ISBN        is not found. MAJAX checks whether the returned record matches the query        by examing MARC fields 020$a for ISBN and 245$a for title searches.        </dd>        <p>        A typical example of success/failure callbacks might look like this:<pre class="example">  function successCallback(majaxresult)  {   // see below for documentation for majaxMakeHarvardReference()   var h = document.getElementById("harvardref");   h.innerHTML = majaxresult.majaxMakeHarvardReference(); } function failureCallback(status)  {    // handle failure case here } ... majax.majaxSearchByISBN(isbn, {        onsuccess : function (result) {            successCallback(result);        },         onfailure: function (status) {             failureCallback(status);         }    }); </pre>     </dd></dl><!-- ----------------------------- --><hr> <dl><dt><a name="majaxMakeEndnoteDisplay"></a><pre> function majaxMakeEndnoteDisplay(doc, labelHTML, showText, hideText, preclass)</pre></dt><dd>Returns a DIV element that can be inserted into document 'doc'.The DIV element is laid out as if it had been created with the followingHTML:<pre class="example">&lt;div&gt;    &lt;a&gt;<font color="red">showText/hideText</font>&lt;/a&gt;&lt;span&gt;&amp;nbsp;<font color="red">labelHTML</font>&lt;/span&gt;    &lt;div&gt;        &lt;pre class="<font color="red">preclass</font>"&gt;     This is where the EndNote display would go        &lt;/pre&gt;    &lt;/div&gt;&lt;/div&gt;</pre><p>Below is shown what the result of this call may look like in the target webpage.Press the "Show" link to see.<div id='med'>   <script type="text/javascript">    this.endnote = "     This is where the EndNote display would go";    var d = majaxMakeEndnoteDisplay(document, "EndNote", "Show", "Hide");    document.getElementById('med').appendChild(d);  </script></div><p>Note 1: you must specify the target 'document' as an argument to this call.Simply passing 'document' should work in most cases.<p>Note 2: any HTML that can be assigned via innerHTML to the createdSPAN document can be used as labelHTML.<p>Note 3: this function is a method of the MAJAX results object. Therefore, a typical calling sequence, which would be included inside a "success" callback function, might be this:<pre class="example"> /*  * This example assumes that the target document contains HTML like this:  * &lt;FORM name="laurel215_form"&gt;  * &lt;/FORM&gt;  * we want to add the EndNote display at the end of the area enclosed  * by the FORM element, i.e., as its last child.  */ var f = document.forms["laurel215_form"];       // 'f' represents the location on the target page where the div should be inserted var endnotediv = majaxresult.majaxMakeEndnoteDisplay(document, "Endnote", "Show", "Hide"); // now place created div as the last child of the target element f.appendChild(endnotediv);</pre></dd><dt><a name="majaxMakeHarvardReference"></a><pre> function majaxMakeHarvardReference()</pre></dt><dd>Create a string that represents an HTML representation of the reference,formatted in so-called Harvard reference style.  This is an example of what it may look like in the target webpage:<p>Levitt, Steven D., Dubner, Stephen J., 2005, <i>Freakonomics : a rogue economist explores the hidden side of everything / </i>1st ed., New York, William Morrow, xii, 242 p. ;<p>A typical use would look like this:<pre class="example"> /*  * This example assumes that the target document contains HTML like this:  * &lt;SPAN id="harvardref"&gt;&lt;/SPAN&gt;  * we want to insert the reference where the (otherwise invisible)  * SPAN element is located  */ var h = document.getElementById("harvardref"); h.innerHTML = majaxresult.majaxMakeHarvardReference();</pre>The code above would typically be included inside a "success" callbackfunction.<p>Currently, majaxMakeHarvardReference() includes the following fields, if present:100$a, all 700$a fields, 260$c, 245$a, 245$b, 250$a, 260$a, 260$b, 300$a.</dd></dl><a name="majaxmarc"><h2>MAJAX's MARC Representation</h2></a>MAJAX retrieves a MARC record from the Millennium catalog. The MARC record is representedas a JavaScript object. This object is stored in the 'marc' property of the result objectpassed to the callback function.This marc object has the following properties.<p>For each MARC field found, there is a property <tt>datafieldNNN</tt> that is an array that corresponds to the NNN data fields found in the record.  For instance,<tt>marc.datafield650[0]</tt> points to the first 650 field found in the MARC record,<tt>marc.datafield650[1]</tt> points to the second 650 field found in the MARC record,and so on.<tt>marc.datafield650.length</tt> gives the number of 650 fields. The alias<tt>marc.f650</tt> is created as a shortcut for <tt>marc.datafield650[0]</tt>.Similarly, <tt>marc.f100</tt> is an alias for <tt>marc.datafield100[0]</tt>, whichpoints to the first---and presumably only--- 100 data field in the MARC record.Note that both marc.f100 and the marc.datafield100 array are undefined if there is no 100 data field in the MARC record.<p>Each MARC field instance is a JavaScript object with the following properties.The properties <tt>ind1</tt> and <tt>ind2</tt> refer to the indicators associated with theMARC record.  The property <tt>subfields</tt> is an object that points to an array of subfields.  It is indexed by the subfield code, e.g., 'a', 'b', etc.  For instance, <tt>marc.f776.subfields['w']</tt> is an array of $w subfields within the first 776 data field.  The actual fields are<tt>marc.f776.subfields['w'][0], marc.f776.subfields['w'][1]</tt> and so on.A shortcut is provided for the first subfield of a given subfield code.For instance, <tt>marc.f020.a</tt> is short for <tt>marc.f020.subfields['a'][0]</tt>,which is shorthand for <tt>marc.datafield020[0].subfields['a'][0]</tt>,which is the first $a subfield within the first 020 data field --- typically theISBN.  Consequently, the following JavaScript code can be used to check forthe existence of a 020$a field in the MARC record:<pre class="example"> if (marc.f020 &amp;&amp; marc.f020.a)     alert('record contains ISBN: ' + marc.f020.a);</pre>Note that you have to check for <tt>marc.f020</tt> before checking for<tt>marc.f020.a</tt> since if the MARC record did not contain a 020 data field,then attempting to access <tt>marc.f020.a</tt> will trigger an exception,aborting the current function.  (A try/catch statement could be used to catchthe exception and continue.)<p><i>Implementation Notes:</i>Control fields (001--008) and data fields are treated alike for simplicity.<p>Subfields without an implicit subfield code are assumed to use subfield code $a (is this correct?).<p>The indicators are preserved as they appear in the record; in particularan empty indicator is a space.</body></html><!-- vim: filetype=htmlm4 -->
